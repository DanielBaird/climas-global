!function e(t,n,i){function r(s,a){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return r(n?n:e)},l,l.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,t,n){e("./reports/main")},{"./reports/main":2}],2:[function(e,t,n){(function(){var t;window.console||(window.console={log:function(){return{}}}),t=e("./views/app"),$(function(){var e;return e=new t,e.render()})}).call(this)},{"./views/app":4}],3:[function(e,t,n){(function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};Array.prototype.forEach||(Array.prototype.forEach=function(t,n){var i,r,o,s;for(s=[],i=r=0,o=this.length;o>=0?o>=r:r>=o;i=o>=0?++r:--r)s.push(e.call(this,i)>=0?t.call(n,this[i],i,this):void 0);return s}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t,n,i;for(t=n=0,i=this.length;i>=0?i>=n:n>=i;t=i>=0?++n:--n)if(this[t]===e)return t;return-1})}).call(this)},{}],4:[function(e,t,n){(function(){var n,i;e("../util/shims"),i=function(e,t){var n,i,r,o;return n=["verydebug","debug","message","warning"],r="message",t||(t="debug"),o=n.indexOf(r),i=n.indexOf(t),o>i?void 0:e+""===e?console.log("["+t+"] "+e):console.log(e)},n=Backbone.View.extend({tagName:"form",className:"",id:"reportform",dataUrl:""+location.protocol+"//"+location.host+"/data",rasterApiUrl:""+location.protocol+"//localhost:10600/api/raster/1/wms_data_url",trackSplitter:!1,trackPeriod:100,events:{"change .sectionselector input":"updateSectionSelection","change .regionselect input":"updateRegionSelection","change .regionselect select":"updateRegionSelection","change .yearselect input":"updateYearSelection","click .getreport":"getReport"},initialize:function(){var e,t,n;return i("AppView.initialize"),_.bindAll.apply(_,[this].concat(_.functions(this))),this.hash="",t=this.fetchReportSections(),e=this.fetchRegions(),n=this.fetchYears(),$.when(t,e,n).then(function(e){return function(){return e.checkHash(),e.updateSummary()}}(this)),$(window).on("hashchange",function(e){return function(){return e.checkHash()}}(this))},render:function(){return i("AppView.render"),this.$el.append(n.templates.layout({})),$("#contentwrap .maincontent").append(this.$el)},checkHash:function(){var e,t,n,i;if(e=window.location.hash,!(this.hash===e||e.length<2)){t=this.splitHash(e);for(n in t)i=t[n],this.applyHashElement(n,i);return this.hash=window.location.hash}},splitHash:function(e){var t,n,i,r,o,s;for(t={},n=e.substring(1).split("/"),r=function(e){return function(e){var n;return n=e.split("="),2===n.length?t[n[0]]=n[1]:void 0}}(this),o=0,s=n.length;s>o;o++)i=n[o],r(i);return t},applyHashElement:function(e,t){var n;return"region"===e&&(n=t.split("_")[0],this.$('input[type=radio][name=regiontype][value="'+n+'"]').click(),this.$('select.regionselector option[value="'+t+'"]').parent().val(t).change()),"year"===e?this.$('input[type=radio][name=year][value="'+t+'"]').click():void 0},makeHash:function(){var e,t,n;return i("AppView.makeHash"),e=this.splitHash(window.location.hash),this.selectedYear&&(e.year=this.selectedYear),this.selectedRegion&&""!==this.selectedRegion&&(e.region=this.selectedRegion),n=function(){var n;n=[];for(t in e)n.push(t+"="+e[t]);return n}().join("/"),location.hash="/"+n},getReport:function(){var e;return i("AppView.getReport"),this.$("#reportform").remove(),e=[],e.push('<form action="/regionreport" method="get" id="reportform">'),e.push('<input type="hidden" name="year" value="'+this.selectedYear+'">'),e.push('<input type="hidden" name="regiontype" value="'+this.selectedRegionType+'">'),e.push('<input type="hidden" name="region" value="'+this.selectedRegion+'">'),e.push('<input type="hidden" name="sections" value="'+this.selectedSections.join(" ")+'">'),e.push("</form>"),this.$el.append(e.join("\n")),this.$("#reportform").submit(),ga&&"function"==typeof ga?ga("send",{hitType:"event",eventCategory:"reportdownload",eventAction:this.selectedRegionType,eventLabel:this.selectedRegion,eventValue:parseInt(this.selectedYear,10)}):void 0},fetchReportSections:function(){var e;return i("AppView.fetchReportSections"),e=$.ajax(this.dataUrl+"/reportsections"),e.done(function(e){return function(t){var n;return e.possibleSections=t.sections,n=e.$(".sectionselect"),n.empty().removeClass("loading"),e.buildReportSectionList(e.possibleSections,n)}}(this)),e.promise()},buildReportSectionList:function(e,t){return i("AppView.buildReportSectionList"),$.each(e,function(e){return function(i,r){var o,s;return o=$(n.templates.sectionSelector(r)),$(t).append(o),r.sections.length>0?(s=$(n.templates.subsections()),e.buildReportSectionList(r.sections,s),$(o).addClass("hassubsections").append(s)):void 0}}(this)),this.updateSummary()},updateSectionSelection:function(e){return i("AppView.updateSectionSelection"),this.handleSectionSelection(this.possibleSections)},handleSectionSelection:function(e,t){return i("AppView.handleSectionSelection"),$.each(e,function(e){return function(t,n){var i,r,o;return r=e.$("#section-"+n.id.replace(/\./g,"\\.")),i=r.find("input"),i.prop("checked")?r.removeClass("unselected"):r.addClass("unselected"),(null!=(o=n.sections)?o.length:void 0)>0?e.handleSectionSelection(n.sections,n.id):void 0}}(this)),this.updateSummary()},fetchRegions:function(){var e;return i("AppView.fetchRegions"),e=$.ajax(this.dataUrl+"/reportregions"),e.done(function(e){return function(t){return e.buildRegionList(t)}}(this)),e.promise()},buildRegionList:function(e){var t;return i("AppView.buildRegionList"),this.regions=e.regiontypes,t=this.$(".regionselect"),t.empty().removeClass("loading"),$.each(this.regions,function(e){return function(e,i){var r,o;return i.optionList=[function(){var e,t,o,s;for(o=i.regions,s=[],e=0,t=o.length;t>e;e++)r=o[e],s.push(n.templates.regionSelector(r));return s}()].join("\n"),o=$(n.templates.regionTypeSelector(i)),t.append(o)}}(this)),this.updateSummary()},updateRegionSelection:function(e){var t;return i("AppView.updateRegionSelection"),t=this.$("[name=regiontype]:checked").val(),$.each(this.regions,function(e){return function(n,i){var r;return r=e.$("#regiontype-"+i.id),t===i.id?(r.addClass("typeselected"),e.selectedRegionType=i.id,e.selectedRegion=$(r.find("select")).val(),""===e.selectedRegion?r.removeClass("regionselected"):(r.addClass("regionselected"),e.selectedRegionInfo=_.find(i.regions,function(t){return t.id===e.selectedRegion}))):r.removeClass("typeselected")}}(this)),this.updateSummary()},fetchYears:function(){var e;return i("AppView.fetchYears"),e=$.Deferred(),e.done(function(e){return function(t){return e.buildYearList(t)}}(this)),setTimeout(function(){return e.resolve({years:["2025","2035","2045","2055","2065","2075","2085"]})},50+50*Math.random()),e.promise()},buildYearList:function(e){var t;return i("AppView.buildYearList"),this.years=e.years,t=this.$(".yearselect"),t.empty().removeClass("loading"),$.each(this.years,function(e){return function(e,i){return t.append(n.templates.yearSelector({year:i}))}}(this)),this.updateSummary()},updateYearSelection:function(e){return i("AppView.updateYearSelection"),this.selectedYear=this.$("[name=year]:checked").val(),$.each(this.years,function(e){return function(t,n){var i;return i=e.$("#year-"+n),e.selectedYear===n?i.addClass("yearselected"):i.removeClass("yearselected")}}(this)),this.updateSummary()},sectionId:function(e){return $(e).find("input").attr("value")},sectionName:function(e){return this.sectionInfo(e).name},sectionInfo:function(e){var t,n,r;return i("AppView.sectionInfo"),r=$(e).parents(".sectionselector"),n=r.map(function(e){return function(t,n){return e.sectionId(n)}}(this)).get().reverse(),n.push(this.sectionId(e)),this.selectedSections.push(this.sectionId(e)),t={sections:this.possibleSections},n.forEach(function(e){return t=_.filter(t.sections,function(t){return t.id===e})[0]}),t},subSectionList:function(e){var t,n;return i("AppView.sectionList"),t=[],n=$(e).children(".subsections"),n.children(".sectionselector").not(".unselected").each(function(e){return function(n,i){var r,o;return r=e.sectionName(i),o=e.subSectionList(i),""!==o&&(r=r+" ("+o+")"),t.push(r)}}(this)),t.join(", ")},updateSummary:function(){var e,t,r,o,s;return i("AppView.updateSummary"),r=this.$(".sectionselect > .sectionselector").not(".unselected"),this.selectedSections=[],t=[],r.each(function(e){return function(n,i){var r,o;return r=e.sectionName(i),o=e.subSectionList(i),""!==o&&(r=r+": "+o.toLowerCase()),t.push(r+".")}}(this)),e="",t.length>0&&(e="<li>"+t.join("</li><li>")+"</li>"),o={regionName:null!=(s=this.selectedRegionInfo)?s.name:void 0,year:this.selectedYear,content:e},this.$(".reviewblock").html(n.templates.reviewBlock(o)),this.$(".reviewblock").toggleClass("regionselected",void 0!==this.selectedRegionInfo),this.$(".reviewblock").toggleClass("yearselected",void 0!==this.selectedYear),this.makeHash()}},{templates:{layout:_.template('<div class="formblock">\n    <h1>Report on</h1>\n    <div class="loading select regionselect">loading available regions..</div>\n\n    <h1>In the year</h1>\n    <div class="loading select yearselect">loading available years..</div>\n\n    <h1>Including</h1>\n    <div class="loading select sectionselect">loading available sections..</div>\n</div>\n<div class="reviewblock"></div>'),reviewBlock:_.template('<h1>Selected Report</h1>\n<p class="coverage">Covers\n    <% if (regionName) { %><%= regionName %><% } else { %><em>(unspecified region)</em><% } %>\n    in\n    <% if (year) { %><%= year %>.<% } else { %><em>(unspecified year)</em>.<% } %>\n</p>\n<ul class="contents"><%= content %></ul>\n<button type="button" class="getreport">download report</button>'),reviewContentItem:_.template("<li>item</li>"),regionTypeSelector:_.template('<div class="regiontypeselector" id="regiontype-<%= id %>">\n    <label class="name"><input\n        class="regiontype"\n        name="regiontype"\n        type="radio"\n        value="<%= id %>"\n    /> <%= name %>\n    </label>\n    <div class="regionselectorwrapper"><select class="regionselector">\n        <option value="" disabled="disabled" selected="selected">select a region&hellip;</option>\n        <%= optionList %>\n    </select></div>\n</div>'),regionSelector:_.template('<option value="<%= id %>"><%= name %></option>'),yearSelector:_.template('<div class="yearrow" id="year-<%= year %>">\n    <label class="name"><input\n        class="year"\n        name="year"\n        type="radio"\n        value="<%= year %>"\n    /> <%= year %></label>\n</div>'),sectionSelector:_.template('<div class="sectionselector<% if (initial != \'included\') { print(\' unselected\'); } %>" id="section-<%= id %>">\n    <label class="name"\n        <% if (presence == \'required\') { print(\'title="This section is required"\'); } %>\n    ><input\n        type="checkbox"\n        value="<%= id %>"\n        <% if (initial == \'included\') { print(\'checked="checked"\'); } %>\n        <% if (presence == \'required\') { print(\'disabled="disabled"\'); } %>\n    /> <%= name %></label>\n    <p class="description"><%= description %></p>\n\n</div>'),subsections:_.template('<div class="subsections clearfix">\n</div>')}}),t.exports=n}).call(this)},{"../util/shims":3}]},{},[1]);