!function e(t,i,n){function a(r,o){if(!i[r]){if(!t[r]){var p="function"==typeof require&&require;if(!o&&p)return p(r,!0);if(s)return s(r,!0);throw new Error("Cannot find module '"+r+"'")}var l=i[r]={exports:{}};t[r][0].call(l.exports,function(e){var i=t[r][1][e];return a(i?i:e)},l,l.exports,e,t,i,n)}return i[r].exports}for(var s="function"==typeof require&&require,r=0;r<n.length;r++)a(n[r]);return a}({1:[function(e,t,i){e("./mapview/main"),$("header").disableSelection(),$("nav > ul").mspp({})},{"./mapview/main":2}],2:[function(e,t,i){(function(){var t;window.console||(window.console={log:function(){return{}}}),t=e("./views/app"),$(function(){var e;return e=new t,e.render()})}).call(this)},{"./views/app":5}],3:[function(e,t,i){(function(){var e;e=Backbone.Model.extend({constructor:function(e,t,i){return this.shortName=e,this.longName=t,this.path=i,null}}),t.exports=e}).call(this)},{}],4:[function(e,t,i){(function(){var e=[].indexOf||function(e){for(var t=0,i=this.length;i>t;t++)if(t in this&&this[t]===e)return t;return-1};Array.prototype.forEach||(Array.prototype.forEach=function(t,i){var n,a,s,r;for(r=[],n=a=0,s=this.length;s>=0?s>=a:a>=s;n=s>=0?++a:--a)r.push(e.call(this,n)>=0?t.call(i,this[n],n,this):void 0);return r}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t,i,n;for(t=i=0,n=this.length;n>=0?n>=i:i>=n;t=n>=0?++i:--i)if(this[t]===e)return t;return-1})}).call(this)},{}],5:[function(e,t,i){(function(){var i,n,a,s=[].indexOf||function(e){for(var t=0,i=this.length;i>t;t++)if(t in this&&this[t]===e)return t;return-1};n=e("../models/maplayer"),e("../util/shims"),a=function(e,t){var i,n,a,s;return i=["verydebug","debug","message","warning"],a="message",t||(t="debug"),s=i.indexOf(a),n=i.indexOf(t),s>n?void 0:e+""===e?console.log("["+t+"] "+e):console.log(e)},i=Backbone.View.extend({tagName:"div",className:"splitmap showforms",id:"splitmap",speciesDataUrl:window.mapConfig.speciesDataUrl,biodivDataUrl:window.mapConfig.biodivDataUrl,rasterApiUrl:window.mapConfig.rasterApiUrl,trackSplitter:!1,trackPeriod:100,events:{"click .btn-change":"toggleForms","click .btn-compare":"toggleSplitter","click .btn-copy.left-valid-map":"copyMapLeftToRight","click .btn-copy.right-valid-map":"copyMapRightToLeft",leftmapupdate:"leftSideUpdate",rightmapupdate:"rightSideUpdate","change select.left":"leftSideUpdate","change select.right":"rightSideUpdate","change input.left":"leftSideUpdate","change input.right":"rightSideUpdate","change #sync":"toggleSync"},tick:function(){return a("tick"),setTimeout(this.tick,1e3)},initialize:function(){return a("AppView.initialize"),_.bindAll.apply(_,[this].concat(_.functions(this))),this.namesList=[],this.speciesSciNameList=[],this.speciesInfoFetchProcess=this.fetchSpeciesInfo(),this.biodivList=[],this.biodivInfoFetchProcess=this.fetchBiodivInfo()},render:function(){return a("AppView.render"),this.$el.append(i.templates.layout({leftTag:i.templates.leftTag(),rightTag:i.templates.rightTag(),leftForm:i.templates.leftForm(),rightForm:i.templates.rightForm()})),$("#contentwrap").append(this.$el),this.map=L.map("map",{center:[0,0],zoom:3}),this.map.on("move",this.resizeThings),L.tileLayer("http://{s}.{base}.maps.cit.api.here.com/maptile/2.1/{type}/{mapID}/{scheme}/{z}/{x}/{y}/{size}/{format}?app_id={app_id}&app_code={app_code}&lg={language}",{attribution:'Map &copy; 2016 <a href="http://developer.here.com">HERE</a>',subdomains:"1234",base:"aerial",type:"maptile",scheme:"terrain.day",app_id:"l2Rye6zwq3u2cHZpVIPO",app_code:"MpXSlNLcLSQIpdU6XHB0TQ",mapID:"newest",maxZoom:18,language:"eng",format:"png8",size:"256"}).addTo(this.map),this.leftForm=this.$(".left.form"),this.buildLeftForm(),this.rightForm=this.$(".right.form"),this.buildRightForm(),this.leftTag=this.$(".left.tag"),this.rightTag=this.$(".right.tag"),this.splitLine=this.$(".splitline"),this.splitThumb=this.$(".splitthumb"),this.leftSideUpdate(),this.rightSideUpdate(),this.toggleSplitter()},resolvePlaceholders:function(e,t){var i,n,a,s;i=e,i=i.replace(/\{\{\s*location.protocol\s*\}\}/g,location.protocol),i=i.replace(/\{\{\s*location.host\s*\}\}/g,location.host),i=i.replace(/\{\{\s*location.hostname\s*\}\}/g,location.hostname);for(n in t)s=t[n],a=new RegExp("\\{\\{\\s*"+n+"\\s*\\}\\}","g"),i=i.replace(a,s);return i},copyMapLeftToRight:function(){return a("AppView.copyMapLeftToRight"),this.leftInfo?(this.$("#rightmapspp").val(this.leftInfo.speciesName),this.$("#rightmapyear").val(this.leftInfo.year),this.$("input[name=rightmapscenario]").each(function(e){return function(t,i){return $(i).prop("checked",$(i).val()===e.leftInfo.scenario)}}(this)),this.$("#rightmapgcm").val(this.leftInfo.gcm),this.rightSideUpdate()):void 0},copyMapRightToLeft:function(){return a("AppView.copyMapRightToLeft"),this.rightInfo?(this.$("#leftmapspp").val(this.rightInfo.speciesName),this.$("#leftmapyear").val(this.rightInfo.year),this.$("input[name=leftmapscenario]").each(function(e){return function(t,i){return $(i).prop("checked",$(i).val()===e.rightInfo.scenario)}}(this)),this.$("#leftmapgcm").val(this.rightInfo.gcm),this.leftSideUpdate()):void 0},sideUpdate:function(e){var t,i,n,r,o;return a("AppView.sideUpdate ("+e+")"),r={speciesName:this.$("#"+e+"mapspp").val(),degs:this.$("#"+e+"mapdegs").val(),range:this.$("input[name="+e+"maprange]:checked").val(),confidence:this.$("#"+e+"mapconfidence").val(),year:this.$("#"+e+"mapyear").val(),scenario:this.$("input[name="+e+"mapscenario]:checked").val(),gcm:this.$("#"+e+"mapgcm").val()},t="current"===r.degs,this.$(["input[name="+e+"maprange]","#"+e+"mapconfidence"].join(",")).prop("disabled",t),this.$("."+e+".side.form fieldset").removeClass("disabled"),this.$("input[name^="+e+"]:disabled, [id^="+e+"]:disabled").closest("fieldset").addClass("disabled"),n="."+e+"-valid-map",o=r.speciesName,s.call(this.namesList,o)>=0?(this.$(n).removeClass("disabled").prop("disabled",!1),i="left"===e?this.leftInfo:this.rightInfo,i&&_.isEqual(r,i)?!1:i&&r.speciesName===i.speciesName&&r.degs===i.degs&&"current"===r.degs?!1:("left"===e?this.leftInfo=r:this.rightInfo=r,this.addMapLayer(e),this.addMapTag(e))):(this.$(n).addClass("disabled").prop("disabled",!0),!1)},leftSideUpdate:function(){return this.sideUpdate("left"),this.$("#sync")[0].checked?(a("Sync checked - syncing right side","message"),this.copySppToRightSide()):void 0},rightSideUpdate:function(){return this.sideUpdate("right")},copySppToRightSide:function(){return this.$("#rightmapspp").val(this.$("#leftmapspp").val()),this.rightSideUpdate()},addMapTag:function(e){var t,i,n;return a("AppView.addMapTag"),"left"===e&&(i=this.leftInfo),"right"===e&&(i=this.rightInfo),n="<b><i>"+i.speciesName+"</i></b>",t={"0disp":"no range adaptation","50disp":"50 years of range adaptation","100disp":"100 years of range adaptation"},n="current"===i.degs?"current "+n+" distribution":"<b>"+i.confidence+"</b> percentile projections for "+n+" at <b>+"+i.degs+"&deg;C</b> with <b>"+t[i.range]+"</b>","left"===e&&this.leftTag.find(".leftlayername").html(n),"right"===e?this.rightTag.find(".rightlayername").html(n):void 0},addMapLayer:function(e){var t,i,n,r,o,p,l,c,h,d;return a("AppView.addMapLayer"),"left"===e&&(p=this.leftInfo),"right"===e&&(p=this.rightInfo),d=p.speciesName,i=s.call(this.biodivList,d)>=0,t="",o="",h="",i?(t=["biodiversity/deciles/biodiversity",p.scenario,p.year,p.gcm].join("_"),"baseline"===p.year&&(t="biodiversity/biodiversity_current"),o=[this.resolvePlaceholders(this.biodivDataUrl,{sppGroup:p.speciesName}),t+".tif"].join("/"),h=[this.resolvePlaceholders(this.biodivDataUrl,{sppGroup:p.speciesName}),"biodiversity",p.speciesName+".zip"].join("/"),this.$("#"+e+"mapdl").attr("href",o)):(t=["/TEMP",p.degs,p.confidence+"."+p.range].join("_"),"current"===p.degs&&(t="/current"),l=p.speciesName.replace(" ","_"),o=[this.resolvePlaceholders(this.speciesDataUrl,{sppName:l,sppGroup:this.speciesGroups[p.speciesName]}),t+".tif"].join("/"),this.$("#"+e+"mapdl").attr("href",o)),n=L.tileLayer.wms(this.resolvePlaceholders(this.rasterApiUrl),{DATA_URL:o,layers:"DEFAULT",format:"image/png",transparent:!0}),r=""+e+"loading",n.on("loading",function(e){return function(){return e.$el.addClass(r)}}(this)),n.on("load",function(e){return function(){return e.$el.removeClass(r)}}(this)),"left"===e&&(this.leftLayer&&this.map.removeLayer(this.leftLayer),this.leftLayer=n),"right"===e&&(this.rightLayer&&this.map.removeLayer(this.rightLayer),this.rightLayer=n),n.addTo(this.map),this.resizeThings(),"localhost"===window.location.hostname&&console.log("map URL is: ",o),ga&&"function"==typeof ga?(c="baseline"===p.year?1990:parseInt(p.year,10),c+={tenth:.1,fiftieth:.5,ninetieth:.9}[p.gcm],ga("send",{hitType:"event",eventCategory:"mapshow",eventAction:p.speciesName,eventLabel:p.scenario,eventValue:c})):void 0},centreMap:function(e){var t,i,n,s;for(a("AppView.centreMap"),e||(e=500),i=function(e){return function(){return e.map.invalidateSize(!1),e.resizeThings()}}(this),s=[],t=n=0;e>=n;t=n+=25)s.push(setTimeout(i,t));return s},toggleForms:function(){return a("AppView.toggleForms"),this.$el.toggleClass("showforms"),this.centreMap()},toggleSplitter:function(){return a("AppView.toggleSplitter"),this.$el.toggleClass("split"),this.$el.hasClass("split")?this.activateSplitter():this.deactivateSplitter(),this.centreMap()},toggleSync:function(){return a("AppView.toggleSync"),this.$("#sync")[0].checked?(this.$(".rightmapspp").prop("disabled",!0),this.copySppToRightSide()):this.$(".rightmapspp").prop("disabled",!1)},fetchSpeciesInfo:function(){return a("AppView.fetchSpeciesInfo"),$.ajax({url:"/data/species",dataType:"json"}).done(function(e){return function(t){var i,n,a,s;return a=[],s=[],n={},i=function(e){var t;return t=" ("+e+")",function(i,n){return a.push({label:n+t,value:e})}},$.each(t,function(e,t){return s.push(e),n[e]=t.group,t.commonNames?$.each(t.commonNames,i(e)):a.push({label:e,value:e})}),e.speciesLookupList=a,e.speciesSciNameList=s,e.speciesGroups=n}}(this))},fetchBiodivInfo:function(){return a("AppView.fetchBiodivInfo"),$.ajax({url:"/data/biodiversity",dataType:"json"}).done(function(e){return function(t){var i,n;return i=[],n=[],$.each(t,function(e,t){var a;return a=e.replace(/^./,function(e){return e.toUpperCase()}),i.push(e),n.push({label:"Biodiversity of "+a,value:e})}),e.biodivList=i,e.biodivLookupList=n}}(this))},buildLeftForm:function(){return a("AppView.buildLeftForm"),$.when(this.speciesInfoFetchProcess,this.biodivInfoFetchProcess).done(function(e){return function(){var t;return t=e.$("#leftmapspp"),e.namesList=e.biodivList.concat(e.speciesSciNameList),t.autocomplete({source:e.biodivLookupList.concat(e.speciesLookupList),close:function(){return e.$el.trigger("leftmapupdate")}})}}(this))},buildRightForm:function(){return a("AppView.buildRightForm"),$.when(this.speciesInfoFetchProcess,this.biodivInfoFetchProcess).done(function(e){return function(){var t;return t=e.$("#rightmapspp"),e.namesList=e.biodivList.concat(e.speciesSciNameList),t.autocomplete({source:e.biodivLookupList.concat(e.speciesLookupList),appendTo:t.closest(".edit"),close:function(){return e.$el.trigger("rightmapupdate")}})}}(this))},startSplitterTracking:function(){return a("AppView.startSplitterTracking"),this.trackSplitter=!0,this.splitLine.addClass("dragging"),this.locateSplitter()},locateSplitter:function(){return a("AppView.locateSplitter"),this.trackSplitter?(this.resizeThings(),0===this.trackSplitter?this.trackSplitter=!1:this.trackSplitter!==!0&&(this.trackSplitter-=1),setTimeout(this.locateSplitter,this.trackPeriod)):void 0},resizeThings:function(){var e,t,i,n,s,r,o,p,l,c,h,d,u,g;if(a("AppView.resizeThings"),this.leftLayer&&(r=$(this.leftLayer.getContainer())),this.rightLayer&&(c=$(this.rightLayer.getContainer())),this.$el.hasClass("split")){if(l=this.splitThumb.position().left+this.splitThumb.width()/2,p=this.map.getContainer(),e=$(p),o=p.getBoundingClientRect(),g=this.map.containerPointToLayerPoint([0,0]),d=this.map.containerPointToLayerPoint([l,0]),t=this.map.containerPointToLayerPoint([e.width(),e.height()]),n=g.y,i=t.y,u=d.x-o.left,s=g.x-o.left,h=t.x,this.splitLine.css("left",l),this.leftTag.attr("style","clip: rect(0, "+l+"px, auto, 0)"),this.leftLayer&&r.attr("style","clip: rect("+n+"px, "+u+"px, "+i+"px, "+s+"px)"),this.rightLayer)return c.attr("style","clip: rect("+n+"px, "+h+"px, "+i+"px, "+u+"px)")}else if(this.leftTag.attr("style","clip: inherit"),this.leftLayer&&r.attr("style","clip: inherit"),this.rightLayer)return c.attr("style","clip: rect(0,0,0,0)")},stopSplitterTracking:function(){return a("AppView.stopSplitterTracking"),this.splitLine.removeClass("dragging"),this.trackSplitter=5},activateSplitter:function(){return a("AppView.activateSplitter"),this.splitThumb.draggable({containment:$("#mapwrapper"),scroll:!1,start:this.startSplitterTracking,drag:this.resizeThings,stop:this.stopSplitterTracking}),this.resizeThings()},deactivateSplitter:function(){return a("AppView.deactivateSplitter"),this.splitThumb.draggable("destroy"),this.resizeThings()}},{templates:{layout:_.template('<div clas="ui-front"></div>\n<div class="splitline">&nbsp;</div>\n<div class="splitthumb"><span>&#x276e; &#x276f;</span></div>\n<div class="left tag"><%= leftTag %></div>\n<div class="right tag"><%= rightTag %></div>\n<div class="left side form"><%= leftForm %></div>\n<div class="right side form"><%= rightForm %></div>\n<div class="left loader"><img src="/static/images/spinner.loadinfo.net.gif" /></div>\n<div class="right loader"><img src="/static/images/spinner.loadinfo.net.gif" /></div>\n<div id="mapwrapper"><div id="map"></div></div>'),leftTag:_.template('<div class="show">\n    <span class="leftlayername">plain map</span>\n    <br>\n    <button class="btn-change">settings</button>\n    <button class="btn-compare">show/hide comparison map</button>\n</div>\n<div class="edit">\n    <label class="left syncbox"></label>\n    <input id="leftmapspp" class="left" type="text" name="leftmapspp" placeholder="&hellip; species or group &hellip;" />\n</div>'),rightTag:_.template('<div class="show">\n    <span class="rightlayername">(no distribution)</span>\n    <br>\n    <button class="btn-change">settings</button>\n    <button class="btn-compare">show/hide comparison map</button>\n</div>\n<div class="edit">\n    <label class="right syncbox"><input id="sync" type="checkbox" value="sync" checked="checked" /> same as left side</label>\n    <input id="rightmapspp" type="text" class="right" name="rightmapspp" placeholder="&hellip; species or group &hellip;" />\n</div>'),leftForm:_.template('<fieldset>\n    <legend>temperature change</legend>\n    <select class="left" id="leftmapdegs">\n        <option value="current">current</option>\n        <option value="1.5">1.5 &deg;C</option>\n        <option value="2">2.0 &deg;C</option>\n        <option value="2.7">2.7 &deg;C</option>\n        <option value="3.2">3.2 &deg;C</option>\n        <option value="4.5">4.5 &deg;C</option>\n        <optgroup label="Highly sensitive environment">\n            <option value="6.5">6.5 &deg;C</option>\n        </optgroup>\n    </select>\n</fieldset>\n<fieldset>\n    <legend>adaptation via range shift</legend>\n    <label><span>none</span> <input name="leftmaprange" class="left" type="radio" value="0disp" checked="checked"> species cannot shift ranges</label>\n    <label><span>50y</span> <input name="leftmaprange" class="left" type="radio" value="50disp"> allow 50 years of range adaptation</label>\n    <label><span>100y</span> <input name="leftmaprange" class="left" type="radio" value="100disp"> allow 100 years of range adaptation</label>\n</fieldset>\n<fieldset>\n    <legend>model summary</legend>\n    <select class="left" id="leftmapconfidence">\n        <option value="10">10th percentile</option>\n        <option value="33">33rd percentile</option>\n        <option value="50" selected="selected">50th percentile</option>\n        <option value="66">66th percentile</option>\n        <option value="90">90th percentile</option>\n    </select>\n</fieldset>\n<fieldset class="blank">\n    <button type="button" class="btn-change">hide settings</button>\n    <button type="button" class="btn-compare">hide/show right map</button>\n    <button type="button" class="btn-copy right-valid-map">copy right map &laquo;</button>\n    <a id="leftmapdl" class="download left-valid-map" href="" disabled="disabled">download just this map<br>(<20Mb GeoTIFF)</a>\n</fieldset>\n'),rightForm:_.template('<fieldset>\n    <legend>temperature change</legend>\n    <select class="right" id="rightmapdegs">\n        <option value="current">current</option>\n        <option value="1.5">1.5 &deg;C</option>\n        <option value="2">2.0 &deg;C</option>\n        <option value="2.7">2.7 &deg;C</option>\n        <option value="3.2">3.2 &deg;C</option>\n        <option value="4.5">4.5 &deg;C</option>\n        <optgroup label="Highly sensitive environment">\n            <option value="6.5">6.5 &deg;C</option>\n        </optgroup>\n    </select>\n</fieldset>\n<fieldset>\n    <legend>adaptation via range shift</legend>\n    <label><span>none</span> <input name="rightmaprange" class="right" type="radio" value="0disp" checked="checked"> species cannot shift ranges</label>\n    <label><span>50y</span> <input name="rightmaprange" class="right" type="radio" value="50disp"> allow 50 years of range adaptation</label>\n    <label><span>100y</span> <input name="rightmaprange" class="right" type="radio" value="100disp"> allow 100 years of range adaptation</label>\n</fieldset>\n<fieldset>\n    <legend>model summary</legend>\n    <select class="right" id="rightmapconfidence">\n        <option value="10">10th percentile</option>\n        <option value="33">33rd percentile</option>\n        <option value="50" selected="selected">50th percentile</option>\n        <option value="66">66th percentile</option>\n        <option value="90">90th percentile</option>\n    </select>\n</fieldset>\n<fieldset class="blank">\n    <button type="button" class="btn-change">hide settings</button>\n    <button type="button" class="btn-compare">hide/show right map</button>\n    <button type="button" class="btn-copy right-valid-map">copy right map &laquo;</button>\n    <a id="rightmapdl" class="download right-valid-map" href="" disabled="disabled">download just this map<br>(<20Mb GeoTIFF)</a>\n</fieldset>\n')}}),t.exports=i}).call(this)},{"../models/maplayer":3,"../util/shims":4}]},{},[1]);