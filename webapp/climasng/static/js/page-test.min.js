!function t(e,i,n){function s(r,o){if(!i[r]){if(!e[r]){var l="function"==typeof require&&require;if(!o&&l)return l(r,!0);if(a)return a(r,!0);throw new Error("Cannot find module '"+r+"'")}var p=i[r]={exports:{}};e[r][0].call(p.exports,function(t){var i=e[r][1][t];return s(i?i:t)},p,p.exports,t,e,i,n)}return i[r].exports}for(var a="function"==typeof require&&require,r=0;r<n.length;r++)s(n[r]);return s}({1:[function(t){t("./mapview/main"),$("header").disableSelection(),$("nav > ul").mspp({})},{"./mapview/main":2}],2:[function(t){(function(){var e;window.console||(window.console={log:function(){return{}}}),e=t("./views/app"),$(function(){var t;return t=new e,t.render()})}).call(this)},{"./views/app":5}],3:[function(t,e){(function(){var t;t=Backbone.Model.extend({constructor:function(t,e,i){return this.shortName=t,this.longName=e,this.path=i,null}}),e.exports=t}).call(this)},{}],4:[function(){(function(){var t=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1};Array.prototype.forEach||(Array.prototype.forEach=function(e,i){var n,s,a,r;for(r=[],n=s=0,a=this.length;a>=0?a>=s:s>=a;n=a>=0?++s:--s)r.push(t.call(this,n)>=0?e.call(i,this[n],n,this):void 0);return r}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e,i,n;for(e=i=0,n=this.length;n>=0?n>=i:i>=n;e=n>=0?++i:--i)if(this[e]===t)return e;return-1})}).call(this)},{}],5:[function(t,e){(function(){var i,n,s,a=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1};n=t("../models/maplayer"),t("../util/shims"),s=function(t,e){var i,n,s,a;return i=["verydebug","debug","message","warning"],s="message",e||(e="debug"),a=i.indexOf(s),n=i.indexOf(e),a>n?void 0:console.log(t+""===t?"["+e+"] "+t:t)},i=Backbone.View.extend({tagName:"div",className:"splitmap showforms",id:"splitmap",speciesDataUrl:window.mapConfig.speciesDataUrl,biodivDataUrl:window.mapConfig.biodivDataUrl,rasterApiUrl:window.mapConfig.rasterApiUrl,trackSplitter:!1,trackPeriod:100,events:{"click .btn-change":"toggleForms","click .btn-compare":"toggleSplitter","click .btn-copy.left-valid-map":"copyMapLeftToRight","click .btn-copy.right-valid-map":"copyMapRightToLeft",leftmapupdate:"leftSideUpdate",rightmapupdate:"rightSideUpdate","change select.left":"leftSideUpdate","change select.right":"rightSideUpdate","change input.left":"leftSideUpdate","change input.right":"rightSideUpdate"},tick:function(){return s("tick"),setTimeout(this.tick,1e3)},initialize:function(){return s("AppView.initialize"),_.bindAll.apply(_,[this].concat(_.functions(this))),this.namesList=[],this.speciesSciNameList=[],this.speciesInfoFetchProcess=this.fetchSpeciesInfo(),this.biodivList=[],this.biodivInfoFetchProcess=this.fetchBiodivInfo()},render:function(){return s("AppView.render"),this.$el.append(i.templates.layout({leftTag:i.templates.leftTag(),rightTag:i.templates.rightTag(),leftForm:i.templates.leftForm(),rightForm:i.templates.rightForm()})),$("#contentwrap").append(this.$el),this.map=L.map("map",{center:[-20,136],zoom:5}),this.map.on("move",this.resizeThings),L.tileLayer("http://otile{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.png",{subdomains:"1234",maxZoom:18,attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a>,\ntiles &copy; <a href="http://www.mapquest.com/" target="_blank">MapQuest</a>'}).addTo(this.map),this.leftForm=this.$(".left.form"),this.buildLeftForm(),this.rightForm=this.$(".right.form"),this.buildRightForm(),this.leftTag=this.$(".left.tag"),this.rightTag=this.$(".right.tag"),this.splitLine=this.$(".splitline"),this.splitThumb=this.$(".splitthumb"),this.leftSideUpdate(),this.rightSideUpdate()},resolvePlaceholders:function(t,e){var i,n,s,a;i=t,i=i.replace(/\{\{\s*location.protocol\s*\}\}/g,location.protocol),i=i.replace(/\{\{\s*location.host\s*\}\}/g,location.host),i=i.replace(/\{\{\s*location.hostname\s*\}\}/g,location.hostname);for(n in e)a=e[n],s=new RegExp("\\{\\{\\s*"+n+"\\s*\\}\\}","g"),i=i.replace(s,a);return i},copyMapLeftToRight:function(){return s("AppView.copyMapLeftToRight"),this.leftInfo?(this.$("#rightmapspp").val(this.leftInfo.speciesName),this.$("#rightmapyear").val(this.leftInfo.year),this.$("input[name=rightmapscenario]").each(function(t){return function(e,i){return $(i).prop("checked",$(i).val()===t.leftInfo.scenario)}}(this)),this.$("#rightmapgcm").val(this.leftInfo.gcm),this.rightSideUpdate()):void 0},copyMapRightToLeft:function(){return s("AppView.copyMapRightToLeft"),this.rightInfo?(this.$("#leftmapspp").val(this.rightInfo.speciesName),this.$("#leftmapyear").val(this.rightInfo.year),this.$("input[name=leftmapscenario]").each(function(t){return function(e,i){return $(i).prop("checked",$(i).val()===t.rightInfo.scenario)}}(this)),this.$("#leftmapgcm").val(this.rightInfo.gcm),this.leftSideUpdate()):void 0},sideUpdate:function(t){var e,i,n,r,o;return s("AppView.sideUpdate ("+t+")"),r={speciesName:this.$("#"+t+"mapspp").val(),year:this.$("#"+t+"mapyear").val(),scenario:this.$("input[name="+t+"mapscenario]:checked").val(),gcm:this.$("#"+t+"mapgcm").val()},e="baseline"===r.year,this.$("input[name="+t+"mapscenario], #"+t+"mapgcm").prop("disabled",e),this.$("fieldset").removeClass("disabled"),this.$("input[name="+t+"mapscenario]:disabled, #"+t+"mapgcm:disabled").closest("fieldset").addClass("disabled"),n="."+t+"-valid-map",o=r.speciesName,a.call(this.namesList,o)>=0?(this.$(n).removeClass("disabled").prop("disabled",!1),i="left"===t?this.leftInfo:this.rightInfo,i&&_.isEqual(r,i)?!1:i&&r.speciesName===i.speciesName&&r.year===i.year&&"baseline"===r.year?!1:("left"===t?this.leftInfo=r:this.rightInfo=r,this.addMapLayer(t),this.addMapTag(t))):(this.$(n).addClass("disabled").prop("disabled",!0),!1)},leftSideUpdate:function(){return this.sideUpdate("left")},rightSideUpdate:function(){return this.sideUpdate("right")},addMapTag:function(t){var e,i;return s("AppView.addMapTag"),"left"===t&&(e=this.leftInfo),"right"===t&&(e=this.rightInfo),i="<b><i>"+e.speciesName+"</i></b>","baseline"===e.year&&(i="current "+i+" distribution",i="<b>"+e.gcm+"</b> percentile projections for "+i+" in <b>"+e.year+"</b> if <b>"+e.scenario+"</b>"),"left"===t&&this.leftTag.find(".leftlayername").html(i),"right"===t?this.rightTag.find(".rightlayername").html(i):void 0},addMapLayer:function(t){var e,i,n,r,o,l,p,c,h,d;return s("AppView.addMapLayer"),"left"===t&&(l=this.leftInfo),"right"===t&&(l=this.rightInfo),d=l.speciesName,i=a.call(this.biodivList,d)>=0,e="",o="",h="",i?(e=["biodiversity/deciles/biodiversity",l.scenario,l.year,l.gcm].join("_"),"baseline"===l.year&&(e="biodiversity/biodiversity_current"),o=[this.resolvePlaceholders(this.biodivDataUrl,{sppGroup:l.speciesName}),e+".tif"].join("/"),h=[this.resolvePlaceholders(this.biodivDataUrl,{sppGroup:l.speciesName}),"biodiversity",l.speciesName+".zip"].join("/"),this.$("#"+t+"mapdl").attr("href",o),this.$("#"+t+"archivedl").html("download this biodiversity group<br>(~100Mb zip)"),this.$("#"+t+"archivedl").attr("href",h)):(e=["/dispersal/deciles/"+l.scenario,l.year,l.gcm].join("_"),"baseline"===l.year&&(e="/realized/vet.suit.cur"),p=l.speciesName.replace(" ","_"),o=[this.resolvePlaceholders(this.speciesDataUrl,{sppName:p,sppGroup:this.speciesGroups[l.speciesName]}),e+".tif"].join("/"),h=[this.resolvePlaceholders(this.speciesDataUrl,{sppName:p,sppGroup:this.speciesGroups[l.speciesName]}),p+".zip"].join("/"),this.$("#"+t+"mapdl").attr("href",o),this.$("#"+t+"archivedl").html("download this species<br>(~2Gb zip)"),this.$("#"+t+"archivedl").attr("href",h)),n=L.tileLayer.wms(this.resolvePlaceholders(this.rasterApiUrl),{DATA_URL:o,layers:"DEFAULT",format:"image/png",transparent:!0}),r=""+t+"loading",n.on("loading",function(t){return function(){return t.$el.addClass(r)}}(this)),n.on("load",function(t){return function(){return t.$el.removeClass(r)}}(this)),"left"===t&&(this.leftLayer&&this.map.removeLayer(this.leftLayer),this.leftLayer=n),"right"===t&&(this.rightLayer&&this.map.removeLayer(this.rightLayer),this.rightLayer=n),n.addTo(this.map),this.resizeThings(),ga&&"function"==typeof ga?(c="baseline"===l.year?1990:parseInt(l.year,10),c+={tenth:.1,fiftieth:.5,ninetieth:.9}[l.gcm],ga("send",{hitType:"event",eventCategory:"mapshow",eventAction:l.speciesName,eventLabel:l.scenario,eventValue:c})):void 0},centreMap:function(t){var e,i,n,a;for(s("AppView.centreMap"),t||(t=500),i=function(t){return function(){return t.map.invalidateSize(!1),t.resizeThings()}}(this),a=[],e=n=0;t>=n;e=n+=25)a.push(setTimeout(i,e));return a},toggleForms:function(){return s("AppView.toggleForms"),this.$el.toggleClass("showforms"),this.centreMap()},toggleSplitter:function(){return s("AppView.toggleSplitter"),this.$el.toggleClass("split"),this.$el.hasClass("split")?this.activateSplitter():this.deactivateSplitter(),this.centreMap()},fetchSpeciesInfo:function(){return s("AppView.fetchSpeciesInfo"),$.ajax({url:"/data/species",dataType:"json"}).done(function(t){return function(e){var i,n,s,a;return s=[],a=[],n={},i=function(t){var e;return e=" ("+t+")",function(i,n){return s.push({label:n+e,value:t})}},$.each(e,function(t,e){return a.push(t),n[t]=e.group,e.commonNames?$.each(e.commonNames,i(t)):s.push({label:t,value:t})}),t.speciesLookupList=s,t.speciesSciNameList=a,t.speciesGroups=n}}(this))},fetchBiodivInfo:function(){return s("AppView.fetchBiodivInfo"),$.ajax({url:"/data/biodiversity",dataType:"json"}).done(function(t){return function(e){var i,n;return i=[],n=[],$.each(e,function(t){var e;return e=t.replace(/^./,function(t){return t.toUpperCase()}),i.push(t),n.push({label:"Biodiversity of "+e,value:t})}),t.biodivList=i,t.biodivLookupList=n}}(this))},buildLeftForm:function(){return s("AppView.buildLeftForm"),$.when(this.speciesInfoFetchProcess,this.biodivInfoFetchProcess).done(function(t){return function(){var e;return e=t.$("#leftmapspp"),t.namesList=t.biodivList.concat(t.speciesSciNameList),e.autocomplete({source:t.biodivLookupList.concat(t.speciesLookupList),appendTo:t.$el,close:function(){return t.$el.trigger("leftmapupdate")}})}}(this))},buildRightForm:function(){return s("AppView.buildRightForm"),$.when(this.speciesInfoFetchProcess,this.biodivInfoFetchProcess).done(function(t){return function(){var e;return e=t.$("#rightmapspp"),t.namesList=t.biodivList.concat(t.speciesSciNameList),e.autocomplete({source:t.biodivLookupList.concat(t.speciesLookupList),appendTo:t.$el,close:function(){return t.$el.trigger("rightmapupdate")}})}}(this))},startSplitterTracking:function(){return s("AppView.startSplitterTracking"),this.trackSplitter=!0,this.splitLine.addClass("dragging"),this.locateSplitter()},locateSplitter:function(){return s("AppView.locateSplitter"),this.trackSplitter?(this.resizeThings(),0===this.trackSplitter?this.trackSplitter=!1:this.trackSplitter!==!0&&(this.trackSplitter-=1),setTimeout(this.locateSplitter,this.trackPeriod)):void 0},resizeThings:function(){var t,e,i,n,a,r,o,l,p,c,h,d,u,f;if(s("AppView.resizeThings"),this.leftLayer&&(r=$(this.leftLayer.getContainer())),this.rightLayer&&(c=$(this.rightLayer.getContainer())),this.$el.hasClass("split")){if(p=this.splitThumb.position().left+this.splitThumb.width()/2,l=this.map.getContainer(),t=$(l),o=l.getBoundingClientRect(),f=this.map.containerPointToLayerPoint([0,0]),d=this.map.containerPointToLayerPoint([p,0]),e=this.map.containerPointToLayerPoint([t.width(),t.height()]),n=f.y,i=e.y,u=d.x-o.left,a=f.x-o.left,h=e.x,this.splitLine.css("left",p),this.leftTag.attr("style","clip: rect(0, "+p+"px, auto, 0)"),this.leftLayer&&r.attr("style","clip: rect("+n+"px, "+u+"px, "+i+"px, "+a+"px)"),this.rightLayer)return c.attr("style","clip: rect("+n+"px, "+h+"px, "+i+"px, "+u+"px)")}else if(this.leftTag.attr("style","clip: inherit"),this.leftLayer&&r.attr("style","clip: inherit"),this.rightLayer)return c.attr("style","clip: rect(0,0,0,0)")},stopSplitterTracking:function(){return s("AppView.stopSplitterTracking"),this.splitLine.removeClass("dragging"),this.trackSplitter=5},activateSplitter:function(){return s("AppView.activateSplitter"),this.splitThumb.draggable({containment:$("#mapwrapper"),scroll:!1,start:this.startSplitterTracking,drag:this.resizeThings,stop:this.stopSplitterTracking}),this.resizeThings()},deactivateSplitter:function(){return s("AppView.deactivateSplitter"),this.splitThumb.draggable("destroy"),this.resizeThings()}},{templates:{layout:_.template('<div class="splitline">&nbsp;</div>\n<div class="splitthumb"><span>&#x276e; &#x276f;</span></div>\n<div class="left tag"><%= leftTag %></div>\n<div class="right tag"><%= rightTag %></div>\n<div class="left side form"><%= leftForm %></div>\n<div class="right side form"><%= rightForm %></div>\n<div class="left loader"><img src="/static/images/spinner.loadinfo.net.gif" /></div>\n<div class="right loader"><img src="/static/images/spinner.loadinfo.net.gif" /></div>\n<div id="mapwrapper"><div id="map"></div></div>'),leftTag:_.template('<div class="show">\n    <span class="leftlayername">plain map</span>\n    <br>\n    <button class="btn-change">settings</button>\n    <button class="btn-compare">show/hide comparison map</button>\n</div>\n<div class="edit">\n    <input id="leftmapspp" class="left" name="leftmapspp" placeholder="&hellip; species or group &hellip;" />\n    <!--\n    <button class="btn-change">hide settings</button>\n    <button class="btn-compare">compare +/-</button>\n    -->\n</div>'),rightTag:_.template('<div class="show">\n    <span class="rightlayername">(no distribution)</span>\n    <br>\n    <button class="btn-change">settings</button>\n    <button class="btn-compare">show/hide comparison map</button>\n</div>\n<div class="edit">\n    <input id="rightmapspp" class="right" name="rightmapspp" placeholder="&hellip; species or group &hellip;" />\n</div>'),leftForm:_.template('<fieldset>\n    <legend>time point</legend>\n    <select class="left" id="leftmapyear">\n        <option value="baseline">current</option>\n        <option>2015</option>\n        <option>2025</option>\n        <option>2035</option>\n        <option>2045</option>\n        <option>2055</option>\n        <option>2065</option>\n        <option>2075</option>\n        <option>2085</option>\n    </select>\n</fieldset>\n<fieldset>\n    <legend>emission scenario</legend>\n    <label><span>RCP 4.5</span> <input name="leftmapscenario" class="left" type="radio" value="RCP45"> lower emissions</label>\n    <label><span>RCP 8.5</span> <input name="leftmapscenario" class="left" type="radio" value="RCP85" checked="checked"> business as usual</label>\n</fieldset>\n<fieldset>\n    <legend>model summary</legend>\n    <select class="left" id="leftmapgcm">\n        <option value="tenth">10th percentile</option>\n        <option value="fiftieth" selected="selected">50th percentile</option>\n        <option value="ninetieth">90th percentile</option>\n    </select>\n</fieldset>\n<fieldset class="blank">\n    <button type="button" class="btn-change">hide settings</button>\n    <button type="button" class="btn-compare">show right map</button>\n    <button type="button" class="btn-copy right-valid-map">copy right map &laquo;</button>\n    <a id="leftmapdl" class="download left-valid-map" href="" disabled="disabled">download just this map<br>(<20Mb GeoTIFF)</a>\n    <a id="leftarchivedl" class="download left-valid-map" href="" disabled="disabled">download this set of maps<br>(~2Gb zip)</a>\n</fieldset>'),rightForm:_.template('<fieldset>\n    <legend>time point</legend>\n    <select class="right" id="rightmapyear">\n        <option value="baseline">current</option>\n        <option>2015</option>\n        <option>2025</option>\n        <option>2035</option>\n        <option>2045</option>\n        <option>2055</option>\n        <option>2065</option>\n        <option>2075</option>\n        <option>2085</option>\n    </select>\n</fieldset>\n<fieldset>\n    <legend>emission scenario</legend>\n    <label><span>RCP 4.5</span> <input name="rightmapscenario" class="right" type="radio" value="RCP45"> lower emissions</label>\n    <label><span>RCP 8.5</span> <input name="rightmapscenario" class="right" type="radio" value="RCP85" checked="checked"> business as usual</label>\n</fieldset>\n<fieldset>\n    <legend>model summary</legend>\n    <select class="right" id="rightmapgcm">\n        <option value="tenth">10th percentile</option>\n        <option value="fiftieth" selected="selected">50th percentile</option>\n        <option value="ninetieth">90th percentile</option>\n    </select>\n</fieldset>\n<fieldset class="blank">\n    <button type="button" class="btn-change">hide settings</button>\n    <button type="button" class="btn-compare">hide right map</button>\n    <button type="button" class="btn-copy left-valid-map">&raquo; copy left map</button>\n    <a id="rightmapdl" class="download right-valid-map" href="" disabled="disabled">download just this map<br>(<20Mb GeoTIFF)</a>\n    <a id="rightarchivedl" class="download right-valid-map" href="" disabled="disabled">download this set of maps<br>(<2Gb zip)</a>\n</fieldset>')}}),e.exports=i}).call(this)},{"../models/maplayer":3,"../util/shims":4}]},{},[1]);